<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestão TOP Líderes - Comunicação</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React e ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <style>
        body { font-family: 'Inter', sans-serif; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.3s ease-out forwards; }
        
        /* Custom scrollbar for horizontal lists */
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- CONFIGURAÇÃO DAS SIGLAS ---
        const ROLES_CONFIG = {
            "TL": { label: "TL", title: "Top Líderes", color: "bg-rose-900 text-white border-rose-950", lightColor: "bg-rose-50 text-rose-900 border-rose-200" },
            "TE": { label: "TE", title: "TL Expansão", color: "bg-green-600 text-white border-green-700", lightColor: "bg-green-50 text-green-800 border-green-200" },
            "TM": { label: "TM", title: "Candidatas Mulheres", color: "bg-pink-500 text-white border-pink-600", lightColor: "bg-pink-50 text-pink-800 border-pink-200" },
            "TA": { label: "TA", title: "Outros", color: "bg-yellow-400 text-slate-900 border-yellow-500", lightColor: "bg-yellow-50 text-yellow-800 border-yellow-200" }
        };

        // --- DADOS ORIGINAIS ---
        const DATA_VERSION = 1767739503; // Atualize esta versão quando quiser forçar recarga dos dados iniciais
        const STORAGE_KEY = `topLideresData_v${DATA_VERSION}`;
        const initialData = [
            {"role1":"TE","role2":"","candidate":"Deputado Faria de Sá","city":"São Paulo","state":"SP","demand":"Entrevista em forma de Linha do Tempo para: Definição de branding e criação de \"Jornal do Candidato\"(Revista Digital com histórico do candidato)","date":"2026-01-15","status":"Pendente","id":1767647088939,"deliveryLink":""},
            {"role1":"TE","role2":"","candidate":"Vereador Paulinho Condutores","city":"Jacareí","state":"SP","demand":"Entrevista","date":"2026-01-15","status":"Pendente","deliveryLink":"","id":1767647088940},
            {"role1":"TE","role2":"","candidate":"Vereador Anderson Martins","city":"Praia Grande","state":"SP","demand":"Entrevista","date":"2026-01-15","status":"Pendente","deliveryLink":"","id":1767647088941},
            {"role1":"TE","role2":"","candidate":"Vereador Dika Xique Xique","city":"Jundiaí","state":"SP","demand":"Visita a sede do partido, Entrevista, Fotos, Cronograma de Postagens","date":"2026-01-13","status":"Pendente","id":1767647088942,"deliveryLink":""},
            {"role1":"TE","role2":"","candidate":"Vereador Val Advogado","city":"Guarujá","state":"SP","demand":"Entrevista","date":"2026-01-15","status":"Pendente","deliveryLink":"","id":1767647088943},
            {"role1":"TE","role2":"","candidate":"Vereador Babá da Farmácia","city":"Sertãozinho","state":"SP","demand":"Entrevista","date":"2026-01-15","status":"Pendente","deliveryLink":"","id":1767647088944},
            {"role1":"TE","role2":"","candidate":"Vereador Anderson Bernardes","city":"Guarujá","state":"SP","demand":"Entrevista","date":"2026-01-15","status":"Pendente","deliveryLink":"","id":1767647088945},
            {"role1":"TL","role2":"TM","candidate":"Sandra Lacerda","city":"Macapá","state":"AP","demand":"Reunião NOVOS MODELOS DE NEGÓCIOS - Associações e Cooperativas para geração de recursos para MULHERES e JOVENS. Incluirmos tema sobre a Formação de Jovens Empreendedores (FJE) Sebrae - Projeto para alunos do ensino médio a partir dos 15 anos.","date":"2026-01-07","status":"Pendente","id":1767647088946,"deliveryLink":""},
            {"role1":"TL","role2":"TM","candidate":"Professora Goreth","city":"Macapá","state":"AP","demand":"Agendar reunião Salas Google e consultoria projetos para jovens","date":"2026-01-06","status":"Pendente","id":1767647088947,"deliveryLink":""},
            {"role1":"TL","role2":"TM","candidate":"Dayane Santos","city":"Fortaleza","state":"CE","demand":"Mockup cartão de visita e logomarca","date":"2025-12-17","status":"Realizada","deliveryLink":"https://drive.google.com/drive/folders/1BsCZaKGCzzankq43KzboAYBPcKd9bDJ3?usp=drive_link","id":1767647088948},
            {"role1":"TE","role2":"","candidate":"GUTO","city":"Carapicuiba","state":"SP","demand":"Entrevista","date":"2026-01-07","status":"Pendente","id":1767647088949,"deliveryLink":""},
            {"role1":"TE","role2":"","candidate":"Vereador Jefferson","city":"São Vicente","state":"SP","demand":"Entrevista","date":"2026-01-07","status":"Pendente","id":1767647088950,"deliveryLink":""},
            {"role1":"TE","role2":"","candidate":"EMERSOM","city":"Cotia","state":"SP","demand":"Entrevista","date":"2026-01-07","status":"Pendente","id":1767647088951,"deliveryLink":""},
            {"role1":"TL","role2":"TM","candidate":"Amanda CSI","city":"João Pessoa","state":"PB","demand":"Ebook","date":"2026-01-05","status":"Pendente","id":1767647088952,"deliveryLink":""},
            {"role1":"TL","role2":"","candidate":"Rosiney","city":"Palhoça","state":"SC","demand":"Entrevista","date":"2026-01-05","status":"Pendente","id":1767647088953,"deliveryLink":""},
            {"role1":"TL","role2":"TM","candidate":"Cris Loureiro","city":"Blumenau","state":"SC","demand":"Entrevista em forma de Linha do Tempo para: Definição de branding e criação de \"Jornal do Candidato\"(Revista Digital com histórico do candidato)","date":"2025-12-20","status":"Pendente","id":1767647088954,"deliveryLink":""},
            {"role1":"TL","role2":"","candidate":"Paulo Soares","city":"Jaú","state":"SP","demand":"Entrevista","date":"2026-01-05","status":"Pendente","id":1767647088955,"deliveryLink":""},
            {"role1":"TL","role2":"TM","candidate":"Dayanne Costa","city":"Fortaleza","state":"CE","demand":"entrevista","date":"12026-01-05","status":"Realizada","deliveryLink":"https://drive.google.com/drive/folders/1jMg5dT9udOojvh9ACVhO-hGRiHr4zCSh?usp=drive_link","id":1767647088956},
            {"role1":"TE","role2":"TM","candidate":"Katia Dias","city":"Juiz de Fora","state":"MG","demand":"Entrevista","date":"2026-01-05","status":"Pendente","id":1767647088957,"deliveryLink":""},
            {"role1":"TL","role2":"","candidate":"Philipe Lemos","city":"Vitória","state":"ES","demand":"Entrevista","date":"2026-01-05","status":"Pendente","id":1767647088958,"deliveryLink":""},
            {"role1":"TL","role2":"TM","candidate":"Professora Goreth","city":"Macapá","state":"AP","demand":"Entrevista","date":"2026-01-05","status":"Pendente","id":1767647088959,"deliveryLink":""},
            {"role1":"TL","role2":"","candidate":"Dr. Levi Lorenzo","city":"Gravataí","state":"RS","demand":"Entrevista","date":"2026-01-05","status":"Pendente","id":1767647088961,"deliveryLink":""},
            {"role1":"TL","role2":"TM","candidate":"Sandra Lacerda","city":"Macapá","state":"AP","demand":"Entrevista","date":"2026-01-05","status":"Pendente","id":1767647088962,"deliveryLink":""},
            {"role1":"TL","role2":"TM","candidate":"Corinha Molling","city":"Sapiranga","state":"RS","demand":"Entrevista","date":"2026-01-05","status":"Pendente","id":1767647088963,"deliveryLink":""},
            {"role1":"TL","role2":"","candidate":"Dep. Samuel Santos","city":"Goiania","state":"GO","demand":"Entrevista","date":"2026-01-15","status":"Pendente","deliveryLink":"","id":1767647088964},
            {"role1":"TL","role2":"","candidate":"Caio Cunha","city":"Mogi das Cruzes","state":"SP","demand":"Entrevista","date":"2026-01-05","status":"Pendente","id":1767647088965,"deliveryLink":""}
        ];

        const Icon = ({ name, className }) => {
            return <i data-lucide={name} className={className}></i>;
        };

        const isLate = (dateString, status) => {
            if (!dateString) return false;
            const statusLower = status.toLowerCase();
            if (statusLower.includes("realizada") || statusLower.includes("entregue") || statusLower.includes("cancelada")) {
                return false;
            }
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            const deadline = new Date(dateString + 'T00:00:00');
            return deadline < today;
        };

        const StatusBadge = ({ status, date }) => {
            let style = "bg-gray-100 text-gray-800 border-gray-200";
            let label = status;
            const s = status.toLowerCase();
            const late = isLate(date, status);

            if (late) {
                style = "bg-red-100 text-red-800 border-red-200 font-bold";
                label = "Ação Atrasada";
            } else if (s.includes("realizada") || s.includes("entregue")) {
                style = "bg-green-100 text-green-800 border-green-200";
            } else if (s.includes("pendente")) {
                style = "bg-blue-100 text-blue-800 border-blue-200";
            } else if (s.includes("aprovação")) {
                style = "bg-yellow-100 text-yellow-800 border-yellow-200";
            } else if (s.includes("cancelada") || s.includes("não")) {
                style = "bg-gray-100 text-gray-500 border-gray-200 decoration-slate-400";
            }

            return (
                <span className={`px-3 py-1 rounded-full text-xs font-medium border whitespace-nowrap ${style}`}>
                    {label}
                </span>
            );
        };

        const ProjectBadge = ({ role }) => {
            if (!role || !ROLES_CONFIG[role]) return null;
            const config = ROLES_CONFIG[role];
            return (
                <span className={`inline-flex items-center justify-center w-8 h-6 rounded text-xs font-bold border shadow-sm ${config.color} mr-1 shrink-0`} title={config.title}>
                    {config.label}
                </span>
            );
        };

        function App() {
            const [demands, setDemands] = useState(() => {
                const saved = localStorage.getItem(STORAGE_KEY);
                if (saved) {
                    const parsed = JSON.parse(saved);
                    return parsed.map(item => ({
                        ...item,
                        role1: item.role1 || item.role || "TA",
                        role2: item.role2 || "",
                        deliveryLink: item.deliveryLink || "" // Migração para incluir o novo campo
                    }));
                }
                return initialData;
            });

            const [searchTerm, setSearchTerm] = useState("");
            const [filterStatus, setFilterStatus] = useState("all");
            const [showVersionBanner, setShowVersionBanner] = useState(false);
            const [showForm, setShowForm] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const fileInputRef = useRef(null);

            useEffect(() => {
                try {
                    const keys = Object.keys(localStorage).filter(k => k.startsWith('topLideresData_v'));
                    if (keys.length > 0 && !keys.includes(STORAGE_KEY)) {
                        setShowVersionBanner(true);
                    }
                } catch (e) {
                    // localStorage pode estar desabilitado
                }
            }, []);

            const [formData, setFormData] = useState({
                role1: "TA",
                role2: "",
                candidate: "",
                city: "",
                state: "SP",
                demand: "",
                date: "",
                status: "Pendente",
                deliveryLink: "" // Novo campo no estado do formulário
            });

            useEffect(() => {
                lucide.createIcons();
            });

            useEffect(() => {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(demands));
            }, [demands]);

            // Estatísticas
            const statusStats = useMemo(() => {
                let pendingCount = 0, approvalCount = 0, lateCount = 0, doneCount = 0;
                demands.forEach(d => {
                    const late = isLate(d.date, d.status);
                    const s = d.status.toLowerCase();
                    if (s.includes("realizada") || s.includes("entregue")) doneCount++;
                    else if (s.includes("cancelada")) {} 
                    else if (late) lateCount++;
                    else if (s.includes("aprovação")) approvalCount++;
                    else pendingCount++;
                });
                return { total: demands.length, late: lateCount, pending: pendingCount, approval: approvalCount, done: doneCount };
            }, [demands]);

            const projectStats = useMemo(() => {
                const countRole = (role) => demands.filter(d => d.role1 === role || d.role2 === role).length;
                return { TL: countRole('TL'), TE: countRole('TE'), TM: countRole('TM'), TA: countRole('TA') };
            }, [demands]);

            // Lista de Candidatos por Projeto para o Resumo
            const candidatesByProject = useMemo(() => {
                const getList = (role) => demands.filter(d => d.role1 === role || d.role2 === role).map(d => ({name: d.candidate, city: d.city}));
                return {
                    TL: getList('TL'),
                    TE: getList('TE'),
                    TM: getList('TM'),
                    TA: getList('TA')
                };
            }, [demands]);

            const handleInputChange = (e) => {
                const { name, value } = e.target;
                setFormData(prev => ({ ...prev, [name]: value }));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (editingId) {
                    setDemands(demands.map(item => item.id === editingId ? { ...formData, id: editingId } : item));
                    setEditingId(null);
                } else {
                    const newDemand = { id: Date.now(), ...formData };
                    setDemands([newDemand, ...demands]);
                    setSearchTerm("");
                    setFilterStatus("all");
                }
                setFormData({ role1: "TA", role2: "", candidate: "", city: "", state: "SP", demand: "", date: "", status: "Pendente", deliveryLink: "" });
                setShowForm(false);
            };

            const handleEdit = (item) => {
                setFormData({
                    role1: item.role1 || "TA",
                    role2: item.role2 || "",
                    candidate: item.candidate,
                    city: item.city,
                    state: item.state,
                    demand: item.demand,
                    date: item.date,
                    status: item.status,
                    deliveryLink: item.deliveryLink || ""
                });
                setEditingId(item.id);
                setShowForm(true);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const handleDelete = (id) => {
                if (confirm("Tem certeza que deseja remover esta demanda?")) {
                    setDemands(demands.filter(d => d.id !== id));
                    if (editingId === id) handleCancelForm();
                }
            };

            const handleCancelForm = () => {
                setShowForm(false);
                setEditingId(null);
                setFormData({ role1: "TA", role2: "", candidate: "", city: "", state: "SP", demand: "", date: "", status: "Pendente", deliveryLink: "" });
            };

            const handleExportJSON = () => {
                const dataStr = JSON.stringify(demands, null, 2);
                const blob = new Blob([dataStr], { type: "application/json" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.download = `backup_top_lideres_${new Date().toISOString().slice(0,10)}.json`;
                link.href = url;
                link.click();
            };

            const handleExportCSV = () => {
                const headers = ["ID", "Sigla Principal", "Sigla Secundária", "Candidato", "Cidade", "Estado", "Demanda", "Link Entrega", "Data Entrega", "Status"];
                const csvRows = [headers.join(",")];
                demands.forEach(row => {
                    const values = [
                        row.id, row.role1 || "", row.role2 || "", row.candidate, row.city, row.state,
                        row.demand ? row.demand.replace(/(\r\n|\n|\r)/gm, " ") : "",
                        row.deliveryLink || "",
                        row.date, row.status
                    ];
                    const escapedValues = values.map(v => `"${String(v || "").replace(/"/g, '""')}"`);
                    csvRows.push(escapedValues.join(","));
                });
                const blob = new Blob(["\uFEFF" + csvRows.join("\n")], { type: "text/csv;charset=utf-8;" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.setAttribute("href", url);
                link.setAttribute("download", `planilha_google_top_lideres_${new Date().toISOString().slice(0,10)}.csv`);
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            const handleImportClick = () => { fileInputRef.current.click(); };

            const clearStoredData = () => {
                Object.keys(localStorage).forEach(k => { if (k.startsWith('topLideresData_v')) localStorage.removeItem(k); });
                localStorage.setItem(STORAGE_KEY, JSON.stringify(initialData));
                setDemands(initialData);
                setShowVersionBanner(false);
                alert('Dados iniciais recarregados com sucesso.');
            }; 

            const handleFileChange = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        let content = event.target.result;
                        const firstBracket = content.indexOf('[');
                        const lastBracket = content.lastIndexOf(']');
                        if (firstBracket !== -1 && lastBracket !== -1) content = content.substring(firstBracket, lastBracket + 1);
                        const importedData = JSON.parse(content);
                        if (Array.isArray(importedData)) {
                            if(confirm(`Deseja carregar ${importedData.length} registros? Isso substituirá os dados atuais.`)) {
                                const normalizedData = importedData.map(d => ({ ...d, role1: d.role1 || d.role || 'TA', role2: d.role2 || "", deliveryLink: d.deliveryLink || "" }));
                                setDemands(normalizedData);
                            }
                        } else alert("Formato de arquivo inválido.");
                    } catch (error) { console.error(error); alert("Erro ao ler o arquivo."); }
                };
                reader.readAsText(file);
                e.target.value = null; 
            };

            const handleReset = () => {
                if(confirm("Isso apagará todas as suas alterações e voltará para a lista original. Tem certeza?")) setDemands(initialData);
            };

            const filteredData = demands.filter(item => {
                const term = searchTerm.toLowerCase();
                const matchRole = (item.role1 && item.role1.toLowerCase().includes(term)) || (item.role2 && item.role2.toLowerCase().includes(term));
                const matchSearch = item.candidate.toLowerCase().includes(term) || 
                                  item.demand.toLowerCase().includes(term) ||
                                  (item.city && item.city.toLowerCase().includes(term)) || matchRole;
                const matchStatus = filterStatus === "all" || item.status === filterStatus;
                return matchSearch && matchStatus;
            })
            // ORDENAÇÃO: Ativos (Por Data Crescente) -> Realizados -> Cancelados
            .sort((a, b) => {
                const getGroup = (item) => {
                    const s = item.status.toLowerCase();
                    if (s.includes("cancelada")) return 3;
                    if (s.includes("realizada") || s.includes("entregue")) return 2;
                    return 1; // Ativos (Pendente, Aprovação, Atrasado)
                };

                const groupA = getGroup(a);
                const groupB = getGroup(b);

                if (groupA !== groupB) return groupA - groupB;

                // Desempate por Data (Crescente)
                // Itens sem data vão para o final
                const dateA = a.date ? new Date(a.date + 'T00:00:00').getTime() : 8640000000000000;
                const dateB = b.date ? new Date(b.date + 'T00:00:00').getTime() : 8640000000000000;

                return dateA - dateB;
            });

            // Verifica se o status selecionado no formulário permite adicionar link
            const isCompletedStatus = (status) => {
                const s = status.toLowerCase();
                return s.includes("realizada") || s.includes("entregue");
            };

            return (
                <div className="min-h-screen pb-12 bg-slate-50">
                    <header className="bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-20 shadow-sm">
                        <div className="max-w-7xl mx-auto flex flex-col md:flex-row md:items-center justify-between gap-4">
                            <div className="flex items-center gap-3">
                                <div className="bg-indigo-600 p-2 rounded-lg text-white">
                                    <Icon name="layout-dashboard" className="w-6 h-6" />
                                </div>
                                <div>
                                    <h1 className="text-xl font-bold text-slate-800">Top Líderes</h1>
                                    <p className="text-xs text-slate-500 flex gap-2 items-center">
                                        <span className="text-green-600 font-semibold flex items-center gap-1">
                                            <Icon name="save" className="w-3 h-3" /> Salvo Automático
                                        </span>
                                    </p>
                                </div>
                            </div>
                            <div className="flex flex-wrap gap-2 items-center">
                                <input type="file" ref={fileInputRef} onChange={handleFileChange} accept=".json" className="hidden" />
                                <button onClick={handleExportCSV} className="px-3 py-2 text-green-700 bg-green-50 hover:bg-green-100 border border-green-200 rounded-lg text-sm font-medium transition flex items-center gap-2">
                                    <Icon name="table" className="w-4 h-4" /> Exportar Planilha
                                </button>
                                <button onClick={handleExportJSON} className="px-3 py-2 text-slate-600 hover:bg-slate-100 rounded-lg text-sm font-medium transition flex items-center gap-2 border border-slate-200">
                                    <Icon name="download" className="w-4 h-4" /> Backup
                                </button>
                                <button onClick={handleImportClick} className="px-3 py-2 text-slate-600 hover:bg-slate-100 rounded-lg text-sm font-medium transition flex items-center gap-2 border border-slate-200">
                                    <Icon name="upload" className="w-4 h-4" /> Importar
                                </button>
                                <button onClick={() => { if (confirm('Remover dados salvos no navegador e recarregar os dados iniciais?')) { clearStoredData(); } }} className="px-3 py-2 text-blue-700 hover:bg-blue-50 border border-blue-200 rounded-lg text-sm font-medium transition flex items-center gap-2">
                                    <Icon name="refresh-cw" className="w-4 h-4" /> Recarregar dados iniciais
                                </button>
                                </button>
                                <button onClick={() => { if(showForm) handleCancelForm(); else setShowForm(true); }} className={`px-4 py-2 rounded-lg text-sm font-medium transition flex items-center justify-center gap-2 shadow-sm ${showForm ? 'bg-red-50 text-red-600 border border-red-200' : 'bg-indigo-600 hover:bg-indigo-700 text-white'}`}>
                                    {showForm ? <><Icon name="x" className="w-4 h-4" /> Cancelar</> : <><Icon name="plus" className="w-4 h-4" /> Nova Demanda</>}
                                </button>
                            </div>
                        </div>
                    </header>

                    {showVersionBanner && (
                        <div className="bg-amber-50 border-l-4 border-amber-400 text-amber-800 px-6 py-3 flex items-center justify-between max-w-7xl mx-auto">
                            <div className="flex items-center gap-3">
                                <Icon name="info" className="w-5 h-5" />
                                <div>
                                    <div className="font-semibold">Nova versão dos dados disponível</div>
                                    <div className="text-sm">Toque em <span className="font-medium">Recarregar agora</span> para atualizar os dados salvos neste dispositivo.</div>
                                </div>
                            </div>
                            <div className="flex items-center gap-2">
                                <button onClick={() => { clearStoredData(); }} className="px-3 py-2 text-blue-700 hover:bg-blue-50 border border-blue-200 rounded-lg text-sm font-medium">Recarregar agora</button>
                                <button onClick={() => setShowVersionBanner(false)} className="px-3 py-2 text-slate-600 hover:bg-slate-100 rounded-lg text-sm font-medium border border-slate-200">Fechar</button>
                            </div>
                        </div>
                    )}

                    <main className="max-w-7xl mx-auto p-6 space-y-6">
                        
                        {/* --- STATUS GERAL --- */}
                        <div>
                            <h2 className="text-sm font-bold text-slate-500 mb-3 uppercase tracking-wider">Status das Demandas</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                                    <p className="text-slate-500 text-xs uppercase font-semibold">Total</p>
                                    <p className="text-2xl font-bold text-slate-800 mt-1">{statusStats.total}</p>
                                </div>
                                <div className="bg-white p-4 rounded-xl border border-rose-200 shadow-sm border-l-4 border-l-rose-600 flex justify-between items-center">
                                    <div>
                                        <p className="text-slate-500 text-xs uppercase font-semibold">Atrasadas</p>
                                        <p className="text-2xl font-bold text-rose-600 mt-1">{statusStats.late}</p>
                                    </div>
                                    <Icon name="alert-triangle" className="text-rose-200 w-8 h-8" />
                                </div>
                                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-blue-500 flex justify-between items-center">
                                    <div>
                                        <p className="text-slate-500 text-xs uppercase font-semibold">Pendentes</p>
                                        <p className="text-2xl font-bold text-blue-600 mt-1">{statusStats.pending}</p>
                                    </div>
                                    <Icon name="clock" className="text-blue-200 w-8 h-8" />
                                </div>
                                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-yellow-500 flex justify-between items-center">
                                    <div>
                                        <p className="text-slate-500 text-xs uppercase font-semibold">Em Aprovação</p>
                                        <p className="text-2xl font-bold text-yellow-600 mt-1">{statusStats.approval}</p>
                                    </div>
                                    <Icon name="alert-circle" className="text-yellow-200 w-8 h-8" />
                                </div>
                                <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm border-l-4 border-l-green-500 flex justify-between items-center">
                                    <div>
                                        <p className="text-slate-500 text-xs uppercase font-semibold">Realizadas</p>
                                        <p className="text-2xl font-bold text-green-600 mt-1">{statusStats.done}</p>
                                    </div>
                                    <Icon name="check-circle" className="text-green-200 w-8 h-8" />
                                </div>
                            </div>
                        </div>

                        {/* --- LISTA DE CANDIDATOS POR PROJETO --- */}
                        <div className="mt-6">
                            <h2 className="text-sm font-bold text-slate-500 mb-3 uppercase tracking-wider">Candidatos por Projeto</h2>
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                {/* TL */}
                                <div className={`rounded-xl border shadow-sm p-4 ${ROLES_CONFIG.TL.lightColor}`}>
                                    <div className="flex justify-between items-center mb-3 border-b border-rose-200 pb-2">
                                        <h3 className="font-bold text-rose-900">Top Líderes (TL)</h3>
                                        <span className="bg-white text-rose-900 text-xs px-2 py-0.5 rounded-full font-bold shadow-sm">{projectStats.TL}</span>
                                    </div>
                                    <ul className="space-y-2 max-h-40 overflow-y-auto pr-1 text-xs">
                                        {candidatesByProject.TL.map((c, i) => (
                                            <li key={i} className="flex justify-between items-center">
                                                <span className="font-medium truncate mr-2" title={c.name}>{c.name}</span>
                                                <span className="text-rose-700/70 text-[10px] truncate max-w-[80px]" title={c.city}>{c.city}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                {/* TE */}
                                <div className={`rounded-xl border shadow-sm p-4 ${ROLES_CONFIG.TE.lightColor}`}>
                                    <div className="flex justify-between items-center mb-3 border-b border-green-200 pb-2">
                                        <h3 className="font-bold text-green-800">TL Expansão (TE)</h3>
                                        <span className="bg-white text-green-800 text-xs px-2 py-0.5 rounded-full font-bold shadow-sm">{projectStats.TE}</span>
                                    </div>
                                    <ul className="space-y-2 max-h-40 overflow-y-auto pr-1 text-xs">
                                        {candidatesByProject.TE.map((c, i) => (
                                            <li key={i} className="flex justify-between items-center">
                                                <span className="font-medium truncate mr-2" title={c.name}>{c.name}</span>
                                                <span className="text-green-700/70 text-[10px] truncate max-w-[80px]" title={c.city}>{c.city}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                {/* TM */}
                                <div className={`rounded-xl border shadow-sm p-4 ${ROLES_CONFIG.TM.lightColor}`}>
                                    <div className="flex justify-between items-center mb-3 border-b border-pink-200 pb-2">
                                        <h3 className="font-bold text-pink-800">Mulheres (TM)</h3>
                                        <span className="bg-white text-pink-800 text-xs px-2 py-0.5 rounded-full font-bold shadow-sm">{projectStats.TM}</span>
                                    </div>
                                    <ul className="space-y-2 max-h-40 overflow-y-auto pr-1 text-xs">
                                        {candidatesByProject.TM.map((c, i) => (
                                            <li key={i} className="flex justify-between items-center">
                                                <span className="font-medium truncate mr-2" title={c.name}>{c.name}</span>
                                                <span className="text-pink-700/70 text-[10px] truncate max-w-[80px]" title={c.city}>{c.city}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                                {/* TA */}
                                <div className={`rounded-xl border shadow-sm p-4 ${ROLES_CONFIG.TA.lightColor}`}>
                                    <div className="flex justify-between items-center mb-3 border-b border-yellow-200 pb-2">
                                        <h3 className="font-bold text-yellow-800">Outros (TA)</h3>
                                        <span className="bg-white text-yellow-800 text-xs px-2 py-0.5 rounded-full font-bold shadow-sm">{projectStats.TA}</span>
                                    </div>
                                    <ul className="space-y-2 max-h-40 overflow-y-auto pr-1 text-xs">
                                        {candidatesByProject.TA.map((c, i) => (
                                            <li key={i} className="flex justify-between items-center">
                                                <span className="font-medium truncate mr-2" title={c.name}>{c.name}</span>
                                                <span className="text-yellow-700/70 text-[10px] truncate max-w-[80px]" title={c.city}>{c.city}</span>
                                            </li>
                                        ))}
                                    </ul>
                                </div>
                            </div>
                        </div>

                        {showForm && (
                            <div className="bg-white p-6 rounded-xl border border-indigo-100 shadow-lg animate-fade-in mb-6 ring-2 ring-indigo-50 mt-6">
                                <h3 className="text-lg font-semibold mb-4 text-indigo-900 flex items-center gap-2">
                                    {editingId ? <Icon name="pencil" className="w-5 h-5" /> : <Icon name="plus-circle" className="w-5 h-5" />}
                                    {editingId ? "Editar Demanda" : "Cadastrar Nova Demanda"}
                                </h3>
                                <form onSubmit={handleSubmit} className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                                    <div className="col-span-1">
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Sigla Principal</label>
                                        <select name="role1" value={formData.role1} onChange={handleInputChange} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                            <option value="TL">TL (Top Líderes)</option>
                                            <option value="TE">TE (TL Expansão)</option>
                                            <option value="TM">TM (Mulheres)</option>
                                            <option value="TA">TA (Outros)</option>
                                        </select>
                                    </div>
                                    <div className="col-span-1">
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Sigla Secundária</label>
                                        <select name="role2" value={formData.role2} onChange={handleInputChange} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                            <option value="">Nenhuma</option>
                                            <option value="TL">TL (Top Líderes)</option>
                                            <option value="TE">TE (TL Expansão)</option>
                                            <option value="TM">TM (Mulheres)</option>
                                            <option value="TA">TA (Outros)</option>
                                        </select>
                                    </div>
                                    <div className="col-span-1 md:col-span-2">
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Nome do Candidato</label>
                                        <input required name="candidate" value={formData.candidate} onChange={handleInputChange} placeholder="Ex: João da Silva" className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                                    </div>
                                    <div className="col-span-1 md:col-span-2">
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Cidade</label>
                                        <input name="city" value={formData.city} onChange={handleInputChange} placeholder="Ex: Campinas" className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                                    </div>
                                    <div className="col-span-1">
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Estado</label>
                                        <select name="state" value={formData.state} onChange={handleInputChange} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                            {["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"].map(uf => (
                                                <option key={uf} value={uf}>{uf}</option>
                                            ))}
                                        </select>
                                    </div>
                                    <div className="col-span-1">
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Prazo de Entrega</label>
                                        <input type="date" name="date" value={formData.date} onChange={handleInputChange} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                                    </div>
                                    <div className="col-span-1 md:col-span-4">
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Status Atual</label>
                                        <select name="status" value={formData.status} onChange={handleInputChange} className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none">
                                            <option value="Pendente">Pendente</option>
                                            <option value="Realizada">Realizada</option>
                                            <option value="Aguardando Aprovação">Aguardando Aprovação</option>
                                            <option value="Cancelada">Cancelada</option>
                                        </select>
                                    </div>
                                    
                                    {/* CAMPO DE LINK CONDICIONAL */}
                                    {isCompletedStatus(formData.status) && (
                                        <div className="col-span-1 md:col-span-4 animate-fade-in">
                                            <label className="block text-sm font-medium text-slate-700 mb-1">Link da Entrega (Drive, YouTube, etc)</label>
                                            <div className="relative">
                                                <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                                                    <Icon name="link" className="w-4 h-4" />
                                                </span>
                                                <input 
                                                    name="deliveryLink" 
                                                    value={formData.deliveryLink} 
                                                    onChange={handleInputChange} 
                                                    placeholder="Cole o link aqui..." 
                                                    className="w-full pl-10 pr-4 py-2 border border-green-300 rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none bg-green-50" 
                                                />
                                            </div>
                                            <p className="text-xs text-slate-500 mt-1">Este link ficará disponível para acesso na tabela.</p>
                                        </div>
                                    )}

                                    <div className="col-span-1 md:col-span-4">
                                        <label className="block text-sm font-medium text-slate-700 mb-1">Descrição da Demanda (Comunicação)</label>
                                        <textarea required rows="2" name="demand" value={formData.demand} onChange={handleInputChange} placeholder="Ex: Criação de Jingle, Edição de Vídeo..." className="w-full p-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:outline-none" />
                                    </div>
                                    <div className="col-span-1 md:col-span-4 flex justify-end gap-2 mt-2">
                                        <button type="button" onClick={handleCancelForm} className="px-4 py-2 text-slate-600 hover:bg-slate-100 rounded-lg transition-colors">Cancelar</button>
                                        <button type="submit" className="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-medium shadow-sm transition-colors">
                                            {editingId ? "Atualizar Demanda" : "Salvar Demanda"}
                                        </button>
                                    </div>
                                </form>
                            </div>
                        )}

                        <div className="bg-white p-4 rounded-xl border border-slate-200 shadow-sm flex flex-col md:flex-row gap-4 justify-between items-center mt-6">
                            <div className="relative w-full md:w-96">
                                <span className="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">
                                    <Icon name="search" className="w-4 h-4" />
                                </span>
                                <input 
                                    type="text" 
                                    placeholder="Buscar candidato, código (TL, TE...), demanda..." 
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="w-full pl-10 pr-4 py-2 border border-slate-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500 focus:outline-none"
                                />
                            </div>
                            <div className="flex gap-2 w-full md:w-auto">
                                <select 
                                    value={filterStatus}
                                    onChange={(e) => setFilterStatus(e.target.value)}
                                    className="px-3 py-2 border border-slate-300 rounded-lg text-sm bg-white focus:ring-2 focus:ring-indigo-500 outline-none w-full"
                                >
                                    <option value="all">Status: Todos</option>
                                    <option value="Pendente">Pendentes</option>
                                    <option value="Realizada">Realizadas</option>
                                    <option value="Aguardando Aprovação">Em Aprovação</option>
                                    <option value="Cancelada">Cancelada</option>
                                </select>
                            </div>
                        </div>

                        <div className="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                            <div className="overflow-x-auto">
                                <table className="w-full text-left text-sm">
                                    <thead className="bg-slate-50 text-slate-600 font-medium border-b border-slate-200">
                                        <tr>
                                            <th className="px-6 py-4">Candidato / Local</th>
                                            <th className="px-6 py-4 w-1/3">Demanda (Comunicação)</th>
                                            <th className="px-6 py-4">Data Entrega</th>
                                            <th className="px-6 py-4">Status</th>
                                            <th className="px-6 py-4 text-right">Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {filteredData.map(item => (
                                            <tr key={item.id} className="hover:bg-slate-50 transition-colors">
                                                <td className="px-6 py-4">
                                                    <div className="flex items-center gap-3">
                                                        <div>
                                                            <div className="flex items-center flex-wrap gap-y-1">
                                                                <ProjectBadge role={item.role1} />
                                                                {item.role2 && <ProjectBadge role={item.role2} />}
                                                                <p className="font-medium text-slate-900">{item.candidate}</p>
                                                            </div>
                                                            <p className="text-xs text-slate-500 flex items-center gap-1 mt-1">
                                                                <Icon name="map-pin" className="w-3 h-3" /> {item.city} - {item.state}
                                                            </p>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td className="px-6 py-4 font-medium text-slate-800 align-top">
                                                    <div>{item.demand}</div>
                                                    
                                                    {/* LINK DE ENTREGA CONDICIONAL NA TABELA */}
                                                    {item.deliveryLink && isCompletedStatus(item.status) && (
                                                        <a 
                                                            href={item.deliveryLink} 
                                                            target="_blank" 
                                                            rel="noopener noreferrer"
                                                            className="inline-flex items-center gap-1 mt-2 text-xs font-semibold text-blue-600 hover:text-blue-800 hover:underline bg-blue-50 px-2 py-1 rounded border border-blue-100 transition-colors"
                                                        >
                                                            <Icon name="external-link" className="w-3 h-3" />
                                                            Acessar Entrega
                                                        </a>
                                                    )}
                                                </td>
                                                <td className="px-6 py-4 text-slate-500 flex items-center gap-2">
                                                    <Icon name="calendar" className="w-4 h-4" />
                                                    {item.date ? item.date.split('-').reverse().join('/') : '-'}
                                                </td>
                                                <td className="px-6 py-4">
                                                    <StatusBadge status={item.status} date={item.date} />
                                                </td>
                                                <td className="px-6 py-4 text-right">
                                                    <div className="flex items-center justify-end gap-2">
                                                        <button 
                                                            onClick={() => handleEdit(item)}
                                                            className="p-1.5 text-slate-400 hover:text-indigo-600 hover:bg-indigo-50 rounded transition-colors"
                                                            title="Editar"
                                                        >
                                                            <Icon name="pencil" className="w-4 h-4" />
                                                        </button>
                                                        <button 
                                                            onClick={() => handleDelete(item.id)}
                                                            className="p-1.5 text-slate-400 hover:text-red-600 hover:bg-red-50 rounded transition-colors"
                                                            title="Excluir"
                                                        >
                                                            <Icon name="trash-2" className="w-4 h-4" />
                                                        </button>
                                                    </div>
                                                </td>
                                            </tr>
                                        ))}
                                        {filteredData.length === 0 && (
                                            <tr>
                                                <td colSpan="5" className="px-6 py-12 text-center text-slate-400">
                                                    Nenhum registro encontrado.
                                                </td>
                                            </tr>
                                        )}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div className="flex justify-between items-center text-xs text-slate-400 mt-8">
                            <span>Sistema de Gestão TOP Líderes - v4.3 (Links de Entrega)</span>
                            <button onClick={handleReset} className="hover:text-red-500 underline">Resetar para Padrão</button>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>